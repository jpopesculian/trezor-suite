name: connect-explorer deploy

on: [workflow_dispatch]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup node
        uses: actions/setup-node@v2
        with:
          node-version-file: ".nvmrc"

      - name: Build and deploy connect explorer
        run: |
          npm install -g yarn && yarn install
          git config --global user.name "trezor-ci"
          git config --global user.email "${{ secrets.TREZOR_BOT_EMAIL }}"
          yarn build:libs
          yarn workspace @trezor/connect-explorer build
          cp -rf packages/connect-explorer/build packages/connect-explorer
          git checkout gh-pages
          git add .
          git commit -m "chore(gh-pages): build connect-explorer"
          git push origin gh-pages -f
          gh config set prompt disabled
          gh pr create --repo trezor/trezor-suite --title "Crowdin translations update" --body "Automatically generated PR for updating crowdin translations." --base develop --label translations
        env:
          GITHUB_TOKEN: ${{ secrets.TREZOR_BOT_TOKEN }}
          CROWDIN_PERSONAL_TOKEN: ${{ secrets.CROWDIN_PERSONAL_TOKEN }}
